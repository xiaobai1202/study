# 多表查询

---

## 多表关系

1. 一对多(多对一)

        多的一方建立外键，指向一方的主键
2. 多对多

        建立第三张中间表，中间表至少包含两个外键，分别关联两方主键
3. 一对一
        
        在任意一方加一个外键，关联另一方的主键，并且设置外键为唯一的

---

## 多表查询

笛卡尔积： 指在数学中，两个集合A集合和B集合的所有组合情况

在多表查询时，需要消除无效的笛卡尔积

1. 连接查询：
    
        内连接： 相当于查询A,B交集部分的数据
        左外连接： 查询左表的所有数据，以及两张表交集部分的数据
        右外连接： 查询右表的所有数据，以及两张表交集部分的数据
        自连接： 当前表与自身的连接查询，自连接必须使用表别名

    1.1 内连接查询 (查询两张表交集部分)

        隐式内连接： SELECT 字段列表 FROM 表1，表2 WHERE 条件....;
        显示内连接： SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件...;

    1.2 外连接查询 

        左外连接： SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 条件;
                包含表1的所有数据和满足条件的表一表2交集数据

        右外连接： SELECT 字段列表 FROM 表1 RIGHT [OUTER] JOIN 表2 ON 条件;
                包含表1的所有数据和满足条件的表一表2交集数据
    
    1.3 自连接

        SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件...;
                自连接查询，可以是内连接查询，也可以是外连接查询

2. 联合查询
        
        把多次查询的结果合并起来，形成一个新的查询结果  union / union all
        union all 是直接将查询结果合并  union会将合并后的结果去重
        联合查询的结果列数必须保持一致，并且数据类型也需要保持一致

        SELECT 字段列表 FROM 表A ... 
        UNION [ALL] 
        SELECT 字段列表 FROM 表B...;

3. 子查询

        在SQL语句中嵌套SELECT 语句称为嵌套查询，又称子查询
        SELECT * FROM t1 WHERE col1 = (SELECT col1 FROM t2);
    
    子查询分类：
        
        1. 标量子查询（子查询结果为单个值）
        2. 列子查询（子查询结果为一个列）
        3. 行子查询（子查询结果为一行）
        4. 表子查询（子查询结果为多行多列）

    3.1 标量子查询

        返回一个简单值的查询作为父查询的查询条件
        常用操作符： >、 >=、 <、 <=、 <>

    3.2 列子查询
        
        子查询返回的结果是一个列 常用  in、 not in 、any、 some、 all

    | 操作符    | 描述                       |
    |--------|--------------------------|
    | IN     | 在指定集合范围内，多选1             |
    | NOT IN | 不在指定集合范围内                |
    | ANY    | 子查询返回列表中，满足任意一个即可        |
    | SOME   | 与any等同，使用SOME的地方都可以使用ANY |
    | ALL    | 子查询返回列表的所有值必须都满足         |

    3.3 行子查询

        子查询返回的结果是一行，可以是多列
        常见操作符： = 、<>、 IN、 NOT IN 
        注意where 后面的条件可以使用元组(a,b)
        示例： SELECT * FROM A WHERE (a,b) = (SELECT a,b FROM B WHERE xxxx)
        
    3.4 表子查询
    
        子查询返回的结果是多行多列
        常见操作符： IN 
        一般放在FROM 后作为一张临时表


        
        