# 事物

---

事物是一组操作的集合，它是一个不可分割的工作单位，事物会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。

对于mysql来说事物是自动提交的，每执行一条DML语句，mysql会立即隐式的提交事物。

## 事物操作

1. 查看/设置事物的提交方式

        查看： SELECT @@autocommit;
        设置： SET @@autocommit = 0;  1-自动提交  0 手动提交
2. 提交事物
        
        COMMIT;

3. 回滚事物

        ROLLBACK;

4. 不设置默认值启动事物

        START TRNSCATION;/BEGIN;
        业务操作
        COMMIT;/ROLLBACK;

---

## 事物的四大特性

1. 原子性（Atomicity）： 事物是不可分割的最小操作单元，要么全部成功，要么全部失败。
2. 一致性（Consistency）： 事物完成时，必须使所有的数据都保持一致状态。
3. 隔离性（Isolation）： 数据库系统提供隔离机制，保证事物在不受外部并发操作影响的独立环境下运行
4. 持久性（Durability）： 事物一旦提交或回滚，它对数据库中的数据改变就是永久的。

---

## 并发事物问题

多个事物并发执行互相影响所产生的问题

| 问题    | 描述                                                 |
|-------|----------------------------------------------------|
| 脏读    | 一个事物读到另外一个事物还没有提交的数据                               |
| 不可重复读 | 一个事务先后读取同一条记录，但两次读取的数据不同，称之为不可重复读                  |
| 幻读    | 一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时又发现这行数据已经存在，好像出现了幻影 |

---

## 并发事务解决-事物隔离级别

√表示会出现，×表示不会出现

| 隔离级别                     | 脏读 | 不可重复读 | 幻读 |
|--------------------------|----|-------|----|
| Read Uncommited          | √  | √     | √  |
| Read Commited            | ×  | √     | √  |
| Repeatable Read(MySQL默认） | ×  | ×     | √  |
| Serializable             | ×  | ×     | ×  |

1. 查看事务隔离级别 

        SELECT @@TRANSICATION_ISOLATION
2. 设置事物隔离级别

        SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL [READ UNCOMMITTED|READ COMMITTED|REPEATABLE READ|SERIALIZABLE]

 

