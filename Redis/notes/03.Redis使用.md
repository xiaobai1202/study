# Redis使用

---

## 全局唯一id

全局id生成器是一种在分布式系统下用来生成全局唯一id的工具，一般要满足下列特性：

1. 唯一性

2. 高可用

3. 高性能

4. 递增性

5. 安全性

        为了增加id的安全性，我们可以不直接使用redis的自增的数值，而是拼接一些其他的信息
        id 组成部分： 符号位(1bit) + 时间戳(31bit)  + 序列号(32bit)

        其中的序列号部分可以用redis的自增，时间错可以用到某一天的毫秒数

---

## 优惠券秒杀下单

超卖问题，需要加锁解决

悲观锁理念： 认为线程安全问题一定发生，因此在操作数据之前先获取锁，确保线程串行

乐观锁理念： 认为线程安全问题不一定发生，因此不加锁，只是在更新数据的时候判断有没有其他线程对数据做了修改 -> 如果数据没被修改则更新数据；如果已经被其他线程修改则重试或者异常

乐观锁数据判断方式：
    
    版本号法： 每当数据做一次修改，版本号加一，修改数据之前和之后判断版本号是否变化
    CAS法： 当数据修改时，先判断要修改的数据是否为之前的数据，只有是之前的数据才更新。

实战07 一人一单